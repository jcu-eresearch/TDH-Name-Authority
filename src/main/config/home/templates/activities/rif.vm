#set($defaultOnError = "&Invalid XML placeholder... prevents ANDS Harvesting records in error&")
#set($group = $systemConfig.getString($defaultOnError, "redbox.identity", "RIF-CS Group"))

##### START Identifier resolution
#set($pidProperty = $systemConfig.getString($defaultOnError, "curation", "pidProperty"))
#set ($pid = $util.getMetadata($object, $pidProperty))
#if ("$!pid" == "")
    #set ($pid = $util.get($item, "metadata", "rdf:resource"))
    #if ("$!pid" == "")
        #set ($pid = $util.get($item, "metadata", "dc.identifier"))
    #end
#end
##### END Identifier resolution

### get pid type
#set($pidPrefix = $pid.substring(0,4))
#if("$!pidPrefix" == "jcu.")
    #set($pidType="local")
#else
    #set($pidType="uri")
#end

#set($funding_source = $util.get($item,"data","FUNDING_SCHEME"))


<registryObjects xmlns="http://ands.org.au/standards/rif-cs/registryObjects"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://services.ands.org.au/documentation/rifcs/1.3/schema/registryObjects.xsd">
    <registryObject group="$util.encodeXml($group)">
        <key>$util.encodeXml($pid)</key>
        <originatingSource>$urlBase</originatingSource>
        <activity type="project">
            <identifier type="$pidType">$util.encodeXml($pid)</identifier>
            <name type="primary"><namePart>$util.encodeXml($util.get($item, "data", "TITLE"))</namePart></name>
            <description type="full">$util.encodeXml($util.get($item, "data", "DESCRIPTION"))</description>
#if("$!funding_source" != "")
            <description type="note">Funding source: $util.encodeXml($funding_source)</description>
#end
            
            ## FOR_CODES
#set($for_codes = $item.getStringList("data", "FOR_CODES"))
#if($for_codes)
    #foreach($i in $for_codes)
            <subject type="anzsrc-for">$i</subject>
    #end
#end

            ## SEO_CODES
#set($seo_codes = $item.getStringList("data", "SEO_CODES"))
#if($seo_codes)
    #foreach($i in $seo_codes)
            <subject type="anzsrc-seo">$i</subject>
    #end
#end

            ## LOCAL Keywords
#set($keywords = $item.getStringList("data", "KEYWORDS"))
#if($keywords)
    #foreach($i in $keywords)
            <subject type="local">$i</subject>
    #end
#end

    #set($relationships = $item.getJsonSimpleList("relationships"))
    

    #if($relationships)
        #foreach($i in $relationships)
            #if($i.getBoolean(false,"isCurated"))
                #set($key = $i.getString("empty","curatedPid"))
                #set($rel = $i.getString("hasParticipant","relationship"))
                #if($key != "empty")
            <relatedObject>
                <key>$util.encodeXml($key)</key>
                <relation type="$util.encodeXml($rel)"/>
            </relatedObject>
                #end
            #end
        #end
    #end
        </activity>
    </registryObject>
</registryObjects>